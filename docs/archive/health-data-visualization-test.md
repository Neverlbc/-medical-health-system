# 健康数据可视化 - 开发与测试文档

## 📋 功能概述
本模块实现了患者健康数据的录入、可视化、统计和预警功能。

**核心亮点**：
- ✅ 5 种数据类型（血压/血糖/心率/体温/体重）
- ✅ ECharts 趋势图可视化
- ✅ 智能状态计算（5 级分级：正常→危险）
- ✅ 实时异常预警
- ✅ 批量录入功能

---

## 🚀 快速测试（5 分钟）

### 1. 启动系统
```bash
# 后端
cd medical-backend/medical-admin
mvn spring-boot:run

# 前端
cd medical-frontend
npm run dev
```

### 2. 登录测试
- 访问：http://localhost:5173
- 账号：`patient` / `patient123`

### 3. 核心功能验证
1. **录入数据**：健康监测 → 批量录入 → 勾选血压(160/100)、血糖(6.5) → 保存
2. **查看趋势**：查看 ECharts 图表，切换数据类型
3. **查看预警**：返回患者首页 → 查看"健康预警"区域（应显示红色 Alert）

---

## 1. 后端 API 测试

### 1.1 创建健康数据 (POST /api/v1/health-data)

#### 测试用例 1：创建血压数据
```bash
POST http://localhost:8080/api/v1/health-data
Authorization: Bearer {token}
Content-Type: application/json

{
  "dataType": "BLOOD_PRESSURE",
  "systolicPressure": 135,
  "diastolicPressure": 88,
  "measureTime": "2025-12-07 10:30:00",
  "remark": "晨起测量"
}
```

**预期结果**：
- ✅ 返回 200 状态码
- ✅ 自动计算状态（status = 0 正常）
- ✅ 自动绑定 patientId

#### 测试用例 2：创建异常血压数据（高血压）
```json
{
  "dataType": "BLOOD_PRESSURE",
  "systolicPressure": 155,
  "diastolicPressure": 98,
  "measureTime": "2025-12-07 14:30:00",
  "remark": "午后测量"
}
```

**预期结果**：
- ✅ status = 2（中度异常 - 2级高血压）

#### 测试用例 3：创建血糖数据
```json
{
  "dataType": "BLOOD_SUGAR",
  "bloodSugar": 6.5,
  "measureTime": "2025-12-07 08:00:00",
  "remark": "空腹血糖"
}
```

**预期结果**：
- ✅ status = 2（糖尿病前期）

#### 测试用例 4：创建心率数据
```json
{
  "dataType": "HEART_RATE",
  "heartRate": 72,
  "measureTime": "2025-12-07 09:00:00",
  "remark": "静息心率"
}
```

**预期结果**：
- ✅ status = 0（正常）

#### 测试用例 5：创建体温数据
```json
{
  "dataType": "TEMPERATURE",
  "temperature": 37.2,
  "measureTime": "2025-12-07 07:00:00",
  "remark": "早晨体温"
}
```

**预期结果**：
- ✅ status = 0（正常）

#### 测试用例 6：创建体重数据
```json
{
  "dataType": "WEIGHT",
  "weight": 70.5,
  "measureTime": "2025-12-07 07:30:00",
  "remark": "空腹体重"
}
```

**预期结果**：
- ✅ status 根据 BMI 计算（需要患者身高数据）

---

### 1.2 分页查询健康数据 (GET /api/v1/health-data/list)

#### 测试用例 7：查询所有数据
```bash
GET http://localhost:8080/api/v1/health-data/list?current=1&size=10
Authorization: Bearer {token}
```

**预期结果**：
- ✅ 返回分页数据
- ✅ 患者只能看到自己的数据
- ✅ 按测量时间倒序排列

#### 测试用例 8：按类型筛选
```bash
GET http://localhost:8080/api/v1/health-data/list?dataType=BLOOD_PRESSURE&current=1&size=10
Authorization: Bearer {token}
```

**预期结果**：
- ✅ 只返回血压数据

---

### 1.3 获取趋势数据 (GET /api/v1/health-data/trend)

#### 测试用例 9：获取血压趋势（最近 30 天）
```bash
GET http://localhost:8080/api/v1/health-data/trend?dataType=BLOOD_PRESSURE&days=30
Authorization: Bearer {token}
```

**预期结果**：
- ✅ 返回按时间正序的数据列表
- ✅ 只包含最近 30 天的数据

#### 测试用例 10：获取血糖趋势（最近 7 天）
```bash
GET http://localhost:8080/api/v1/health-data/trend?dataType=BLOOD_SUGAR&days=7
Authorization: Bearer {token}
```

**预期结果**：
- ✅ 返回最近 7 天的血糖数据

---

### 1.4 获取统计信息 (GET /api/v1/health-data/statistics)

#### 测试用例 11：获取统计数据
```bash
GET http://localhost:8080/api/v1/health-data/statistics
Authorization: Bearer {token}
```

**预期结果**：
```json
{
  "totalCount": 15,
  "recentCount": 5,
  "abnormalCount": 3
}
```

---

### 1.5 删除健康数据 (DELETE /api/v1/health-data/{id})

#### 测试用例 12：删除自己的数据
```bash
DELETE http://localhost:8080/api/v1/health-data/1
Authorization: Bearer {token}
```

**预期结果**：
- ✅ 成功删除
- ✅ 返回 200

#### 测试用例 13：患者尝试删除他人数据
```bash
DELETE http://localhost:8080/api/v1/health-data/999
Authorization: Bearer {patient_token}
```

**预期结果**：
- ✅ 返回 403（权限不足）

---

## 2. 前端功能测试

### 2.1 健康数据页面 (HealthDataView.vue)

#### 测试用例 14：页面加载
- ✅ 页面正常加载
- ✅ 显示统计卡片（正常数据/异常数据/总记录数）
- ✅ 显示 ECharts 趋势图
- ✅ 显示数据列表（表格）

#### 测试用例 15：统计卡片显示
- ✅ 正常数据卡片（绿色图标）
- ✅ 异常数据卡片（橙色图标）
- ✅ 总记录数卡片（蓝色图标）
- ✅ 数值正确

#### 测试用例 16：ECharts 趋势图
- ✅ 默认显示血压趋势（收缩压/舒张压双线）
- ✅ 切换到血糖（单线 + 警戒线）
- ✅ 切换到心率（单线 + 警戒线）
- ✅ 切换到体温（单线 + 警戒线）
- ✅ 切换到体重（单线）
- ✅ 图表响应式缩放
- ✅ 鼠标悬停显示 tooltip

#### 测试用例 17：数据列表
- ✅ 显示数据类型（带颜色标签）
- ✅ 显示数值（格式化正确）
- ✅ 显示测量时间
- ✅ 显示状态（颜色标签：正常/异常）
- ✅ 显示备注
- ✅ 分页功能正常

#### 测试用例 18：新增单条记录
- ✅ 点击"新增记录"按钮
- ✅ 弹出对话框
- ✅ 选择数据类型后，动态显示对应字段
  - 血压：收缩压 + 舒张压
  - 血糖：血糖值
  - 心率：心率
  - 体温：体温
  - 体重：体重
- ✅ 表单验证（必填项）
- ✅ 提交成功后刷新列表和图表

#### 测试用例 19：批量录入
- ✅ 点击"批量录入"按钮
- ✅ 弹出对话框
- ✅ 可勾选多种数据类型
- ✅ 勾选后显示对应输入框
- ✅ 至少选择一种类型才能提交
- ✅ 提交成功显示录入条数

#### 测试用例 20：删除记录
- ✅ 点击删除按钮
- ✅ 显示确认弹窗
- ✅ 确认后删除成功
- ✅ 刷新列表和统计

---

### 2.2 患者仪表盘 (PatientDashboardView.vue)

#### 测试用例 21：健康预警卡片
- ✅ 显示"健康预警"区域
- ✅ 如果没有异常数据，显示"太棒了！您最近 7 天的健康数据都很正常 🎉"
- ✅ 如果有异常数据，显示 Alert 列表

#### 测试用例 22：异常数据 Alert
- ✅ 危险级别（status = 4）：红色 error 类型
- ✅ 重度异常（status = 3）：红色 error 类型
- ✅ 中度异常（status = 2）：黄色 warning 类型
- ✅ 轻度异常（status = 1）：灰色 info 类型
- ✅ 显示数据类型、测量值、测量时间、建议

#### 测试用例 23：预警刷新
- ✅ 点击"刷新"按钮
- ✅ 重新加载异常数据
- ✅ 显示 loading 状态

#### 测试用例 24：跳转到健康数据页面
- ✅ 点击"查看详细数据"链接
- ✅ 跳转到健康数据页面

---

## 3. 异常状态计算验证

### 3.1 血压状态
| 收缩压/舒张压 | 预期状态 | 状态文本 |
|---------------|----------|----------|
| 120/80 | 0 | 正常 |
| 85/55 | 1 | 低血压 |
| 145/92 | 2 | 1级高血压 |
| 165/105 | 3 | 2级高血压 |
| 185/115 | 4 | 3级高血压/危险 |

### 3.2 血糖状态
| 血糖值 (mmol/L) | 预期状态 | 状态文本 |
|-----------------|----------|----------|
| 5.5 | 0 | 正常 |
| 3.5 | 1 | 低血糖 |
| 6.5 | 2 | 糖尿病前期 |
| 8.0 | 3 | 糖尿病 |
| 12.0 | 4 | 危险 |

### 3.3 心率状态
| 心率 (bpm) | 预期状态 | 状态文本 |
|------------|----------|----------|
| 72 | 0 | 正常 |
| 55 | 1 | 轻度心动过缓 |
| 110 | 2 | 轻度心动过速 |
| 140 | 3 | 中度异常 |
| 35 | 4 | 危险 |

### 3.4 体温状态
| 体温 (℃) | 预期状态 | 状态文本 |
|----------|----------|----------|
| 36.5 | 0 | 正常 |
| 37.5 | 1 | 低热或体温偏低 |
| 38.5 | 2 | 中度发热 |
| 39.5 | 3 | 高热 |
| 41.5 | 4 | 危险 |

### 3.5 体重状态（基于 BMI）
假设身高 170cm：
| 体重 (kg) | BMI | 预期状态 | 状态文本 |
|-----------|-----|----------|----------|
| 60 | 20.8 | 0 | 正常 |
| 52 | 18.0 | 1 | 偏瘦 |
| 72 | 24.9 | 2 | 超重 |
| 82 | 28.4 | 3 | 肥胖 |
| 102 | 35.3 | 4 | 危险 |

---

## 4. 兼容性测试

### 4.1 浏览器兼容性
- ✅ Chrome (最新版)
- ✅ Edge (最新版)
- ✅ Firefox (最新版)
- ⚠️ Safari (可能需要测试)

### 4.2 响应式布局
- ✅ 桌面端（>1200px）
- ✅ 平板端（768px - 1199px）
- ⚠️ 移动端（<768px）：图表可能需要优化

---

## 5. 性能测试

### 5.1 图表渲染性能
- ✅ ECharts 初始化时间 < 500ms
- ✅ 切换数据类型响应时间 < 300ms
- ✅ 大数据量（100+ 条）渲染流畅

### 5.2 API 响应时间
- ✅ 创建数据 < 200ms
- ✅ 查询列表 < 300ms
- ✅ 趋势数据 < 400ms
- ✅ 统计数据 < 200ms

---

## 6. 错误处理测试

### 6.1 前端错误处理
- ✅ 网络错误：显示友好提示
- ✅ 表单验证：显示错误信息
- ✅ 空数据：显示空状态提示

### 6.2 后端错误处理
- ✅ 权限不足：返回 403
- ✅ 数据不存在：返回 404
- ✅ 参数错误：返回 400 + 错误信息

---

## 7. 安全测试

### 7.1 权限控制
- ✅ 患者只能查看自己的数据
- ✅ 患者不能查看他人的数据
- ✅ 医生可以查看指定患者的数据
- ✅ 未登录用户无法访问

### 7.2 数据验证
- ✅ 后端验证必填字段
- ✅ 后端验证数据类型
- ✅ 后端验证数值范围（可选）

---

## 8. 用户体验测试

### 8.1 视觉设计
- ✅ 颜色区分清晰（正常/异常）
- ✅ 图标使用恰当
- ✅ 布局美观、间距合理

### 8.2 交互体验
- ✅ 加载状态显示
- ✅ 操作反馈及时（成功/失败提示）
- ✅ 表单交互流畅
- ✅ 批量录入体验良好

---

## 测试结论

### 已通过功能
1. ✅ 健康数据录入（单条/批量）
2. ✅ 数据列表展示与分页
3. ✅ ECharts 趋势图（5 种数据类型）
4. ✅ 异常状态自动计算（0-4 级）
5. ✅ 统计卡片（正常/异常/总数）
6. ✅ 患者仪表盘预警提示
7. ✅ 权限控制（患者/医生/管理员）
8. ✅ 删除功能

### 待优化项
1. ⚠️ 移动端响应式布局优化
2. ⚠️ 图表数据点过多时的性能优化
3. ⚠️ 添加数据导出功能（Excel/PDF）
4. ⚠️ 添加健康建议（AI 辅助）

### 已知问题
- 无

---

---

**开发完成时间**：2025-12-07  
**测试状态**：✅ 通过

